<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escape Island Adventure</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Georgia', serif;
            user-select: none;
        }
        
        body {
            background: linear-gradient(135deg, #0a192f, #1a365d);
            color: #e2e8f0;
            min-height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .game-container {
            width: 100%;
            max-width: 1400px;
            height: 90vh;
            margin: 20px;
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            grid-template-rows: 1fr auto;
            gap: 20px;
            position: relative;
        }
        
        @media (max-width: 1100px) {
            .game-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
                height: auto;
                min-height: 90vh;
            }
        }
        
        .panel {
            background: rgba(15, 23, 42, 0.85);
            border-radius: 20px;
            border: 2px solid rgba(100, 116, 139, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }
        
        .stats-panel {
            display: flex;
            flex-direction: column;
            padding: 25px;
            position: relative;
            overflow-y: auto;
        }
        
        .game-title {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(56, 189, 248, 0.3);
        }
        
        h1 {
            font-size: 2.2rem;
            color: #38bdf8;
            text-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 1rem;
            color: #94a3b8;
            font-style: italic;
        }
        
        .player-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(56, 189, 248, 0.2);
            transition: all 0.3s;
        }
        
        .stat:hover {
            border-color: #38bdf8;
            transform: translateY(-3px);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #38bdf8;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #cbd5e1;
        }
        
        .inventory-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .inventory-title {
            font-size: 1.3rem;
            color: #38bdf8;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            flex: 1;
            overflow-y: auto;
            padding: 5px;
        }
        
        .inventory-slot {
            aspect-ratio: 1;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 10px;
            border: 2px dashed rgba(100, 116, 139, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            cursor: pointer;
            padding: 10px;
            text-align: center;
        }
        
        .inventory-slot:hover {
            border-color: #38bdf8;
            transform: scale(1.05);
        }
        
        .inventory-slot.empty {
            opacity: 0.5;
        }
        
        .inventory-slot img {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
        }
        
        .item-name {
            font-size: 0.8rem;
            color: #e2e8f0;
            margin-top: 5px;
        }
        
        .item-description {
            font-size: 0.7rem;
            color: #94a3b8;
            display: none;
        }
        
        .game-view-panel {
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .scene-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #0f172a;
            border-radius: 18px 18px 0 0;
        }
        
        .scene {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            position: relative;
            transition: all 0.8s ease;
        }
        
        .scene-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            pointer-events: none;
        }
        
        .hotspot {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(56, 189, 248, 0.3);
            border: 2px solid rgba(56, 189, 248, 0.8);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 10;
            animation: pulse 2s infinite;
        }
        
        .hotspot:hover {
            background: rgba(56, 189, 248, 0.5);
            transform: scale(1.2);
        }
        
        .hotspot i {
            color: white;
            font-size: 1.2rem;
        }
        
        .hotspot-label {
            position: absolute;
            top: -30px;
            background: rgba(15, 23, 42, 0.9);
            padding: 5px 10px;
            border-radius: 5px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            font-size: 0.9rem;
            border: 1px solid rgba(56, 189, 248, 0.5);
        }
        
        .hotspot:hover .hotspot-label {
            opacity: 1;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(56, 189, 248, 0); }
            100% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0); }
        }
        
        .action-panel {
            background: rgba(15, 23, 42, 0.95);
            padding: 20px;
            border-top: 2px solid rgba(56, 189, 248, 0.3);
            border-radius: 0 0 18px 18px;
            min-height: 150px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .location-title {
            font-size: 1.5rem;
            color: #38bdf8;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .location-description {
            color: #cbd5e1;
            line-height: 1.6;
            margin-bottom: 15px;
            font-size: 1.05rem;
        }
        
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .action-btn {
            padding: 10px 20px;
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(56, 189, 248, 0.3);
            color: #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-btn:hover {
            background: rgba(56, 189, 248, 0.2);
            border-color: #38bdf8;
            transform: translateY(-2px);
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .action-btn:disabled:hover {
            background: rgba(30, 41, 59, 0.9);
            border-color: rgba(56, 189, 248, 0.3);
        }
        
        .dialog-panel {
            padding: 25px;
            display: flex;
            flex-direction: column;
        }
        
        .dialog-title {
            font-size: 1.3rem;
            color: #38bdf8;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dialog-box {
            flex: 1;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 20px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid rgba(56, 189, 248, 0.2);
            line-height: 1.6;
        }
        
        .dialog-message {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
            animation: fadeIn 0.5s;
        }
        
        .dialog-message:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        .dialog-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .dialog-input input {
            flex: 1;
            padding: 12px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(56, 189, 248, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
        }
        
        .dialog-input input:focus {
            outline: none;
            border-color: #38bdf8;
        }
        
        .dialog-input button {
            padding: 12px 20px;
            background: rgba(56, 189, 248, 0.2);
            border: 1px solid #38bdf8;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .dialog-input button:hover {
            background: rgba(56, 189, 248, 0.4);
        }
        
        .game-notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 15px 25px;
            background: rgba(15, 23, 42, 0.95);
            border-left: 4px solid #38bdf8;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.5s ease;
            max-width: 400px;
        }
        
        .game-notification.show {
            transform: translateX(0);
        }
        
        .notification-title {
            color: #38bdf8;
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification-message {
            color: #cbd5e1;
            font-size: 0.95rem;
        }
        
        .puzzle-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            display: none;
        }
        
        .puzzle-content {
            background: rgba(15, 23, 42, 0.95);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            border: 2px solid #38bdf8;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .puzzle-title {
            color: #38bdf8;
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .puzzle-instructions {
            color: #cbd5e1;
            margin-bottom: 25px;
            line-height: 1.6;
            text-align: center;
        }
        
        .puzzle-body {
            margin-bottom: 25px;
        }
        
        .puzzle-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .puzzle-btn {
            padding: 12px 25px;
            background: rgba(56, 189, 248, 0.2);
            border: 1px solid #38bdf8;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        .puzzle-btn:hover {
            background: rgba(56, 189, 248, 0.4);
        }
        
        .combination-lock {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .dial {
            width: 60px;
            height: 60px;
            background: rgba(30, 41, 59, 0.9);
            border: 2px solid #38bdf8;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            font-weight: bold;
        }
        
        .dial-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .dial-btn {
            width: 30px;
            height: 30px;
            background: rgba(56, 189, 248, 0.2);
            border: 1px solid #38bdf8;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .dial-btn:hover {
            background: rgba(56, 189, 248, 0.4);
        }
        
        .inventory-item.selected {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }
        
        .item-details {
            margin-top: 20px;
            padding: 15px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 10px;
            border: 1px solid rgba(56, 189, 248, 0.2);
            display: none;
        }
        
        .item-details.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        .item-details-title {
            color: #fbbf24;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .item-details-description {
            color: #cbd5e1;
            line-height: 1.5;
            font-size: 0.95rem;
        }
        
        .health-bar {
            height: 10px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(to right, #10b981, #34d399);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .energy-bar {
            height: 10px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .energy-fill {
            height: 100%;
            background: linear-gradient(to right, #3b82f6, #60a5fa);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .floating-item {
            animation: float 3s ease-in-out infinite;
        }
        
        .game-over-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            display: none;
        }
        
        .game-over-content {
            background: rgba(15, 23, 42, 0.95);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 700px;
            text-align: center;
            border: 2px solid #38bdf8;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .game-over-title {
            font-size: 3rem;
            color: #38bdf8;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
        }
        
        .game-over-message {
            color: #cbd5e1;
            font-size: 1.2rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .game-over-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .game-over-stat {
            background: rgba(30, 41, 59, 0.7);
            padding: 20px;
            border-radius: 10px;
        }
        
        .game-over-stat-value {
            font-size: 2rem;
            color: #fbbf24;
            margin-bottom: 5px;
        }
        
        .game-over-stat-label {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .restart-btn {
            padding: 15px 40px;
            background: linear-gradient(to right, #38bdf8, #0ea5e9);
            border: none;
            color: white;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        .restart-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(56, 189, 248, 0.3);
        }
        
        .mini-map {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid rgba(56, 189, 248, 0.2);
        }
        
        .mini-map-title {
            color: #38bdf8;
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .map-locations {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .map-location {
            padding: 10px 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .map-location:hover {
            border-color: #38bdf8;
            background: rgba(56, 189, 248, 0.1);
        }
        
        .map-location.active {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }
        
        .location-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #94a3b8;
        }
        
        .map-location.active .location-indicator {
            background: #fbbf24;
            box-shadow: 0 0 10px #fbbf24;
        }
        
        .location-name {
            flex: 1;
            color: #cbd5e1;
        }
        
        @media (max-width: 768px) {
            .game-container {
                margin: 10px;
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                gap: 15px;
            }
            
            .player-stats {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .inventory-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .game-over-stats {
                grid-template-columns: 1fr;
            }
        }
        
        .achievement-badge {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: rgba(15, 23, 42, 0.95);
            border-left: 4px solid #fbbf24;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transform: translateX(-150%);
            transition: transform 0.5s ease;
            z-index: 1000;
            max-width: 300px;
        }
        
        .achievement-badge.show {
            transform: translateX(0);
        }
        
        .achievement-title {
            color: #fbbf24;
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .achievement-desc {
            color: #cbd5e1;
            font-size: 0.9rem;
        }
        
        .sound-control {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(56, 189, 248, 0.3);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s;
        }
        
        .sound-control:hover {
            border-color: #38bdf8;
            transform: scale(1.1);
        }
        
        .sound-control i {
            color: #38bdf8;
            font-size: 1.2rem;
        }
        
        .game-hint {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(56, 189, 248, 0.3);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: help;
            z-index: 100;
            transition: all 0.3s;
        }
        
        .game-hint:hover {
            border-color: #38bdf8;
            transform: scale(1.1);
        }
        
        .game-hint i {
            color: #38bdf8;
            font-size: 1.5rem;
        }
        
        .hint-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            display: none;
        }
        
        .hint-content {
            background: rgba(15, 23, 42, 0.95);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            border: 2px solid #38bdf8;
        }
        
        .hint-title {
            color: #38bdf8;
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .hint-text {
            color: #cbd5e1;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .hint-close {
            padding: 10px 25px;
            background: rgba(56, 189, 248, 0.2);
            border: 1px solid #38bdf8;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: block;
            margin: 0 auto;
        }
        
        .hint-close:hover {
            background: rgba(56, 189, 248, 0.4);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="panel stats-panel">
            <div class="game-title">
                <h1>ESCAPE ISLAND</h1>
                <div class="subtitle">A Survival Adventure</div>
            </div>
            
            <div class="player-stats">
                <div class="stat">
                    <div class="stat-value" id="healthValue">100</div>
                    <div class="stat-label">HEALTH</div>
                    <div class="health-bar">
                        <div class="health-fill" id="healthBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="energyValue">100</div>
                    <div class="stat-label">ENERGY</div>
                    <div class="energy-bar">
                        <div class="energy-fill" id="energyBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="dayValue">1</div>
                    <div class="stat-label">DAY</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="timeValue">08:00</div>
                    <div class="stat-label">TIME</div>
                </div>
            </div>
            
            <div class="inventory-panel">
                <div class="inventory-title">
                    <i class="fas fa-backpack"></i>
                    <span>INVENTORY</span>
                </div>
                <div class="inventory-grid" id="inventoryGrid">
                    <!-- Inventory slots will be populated by JavaScript -->
                </div>
                <div class="item-details" id="itemDetails">
                    <div class="item-details-title" id="itemDetailsTitle">Item Name</div>
                    <div class="item-details-description" id="itemDetailsDescription">Item description will appear here when you select an item.</div>
                </div>
            </div>
            
            <div class="mini-map">
                <div class="mini-map-title">
                    <i class="fas fa-map"></i>
                    <span>ISLAND MAP</span>
                </div>
                <div class="map-locations" id="mapLocations">
                    <!-- Map locations will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="panel game-view-panel">
            <div class="sound-control" id="soundControl">
                <i class="fas fa-volume-up"></i>
            </div>
            
            <div class="scene-container">
                <div class="scene" id="scene" style="background-image: url('https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80');">
                    <div class="scene-overlay"></div>
                    <!-- Hotspots will be added dynamically -->
                </div>
            </div>
            
            <div class="action-panel">
                <div class="location-title">
                    <i class="fas fa-map-marker-alt"></i>
                    <span id="locationTitle">Beach Shoreline</span>
                </div>
                <div class="location-description" id="locationDescription">
                    You wake up on a sandy beach, the sound of waves crashing nearby. The wreckage of a ship is visible further down the coast. The jungle ahead looks dark and foreboding.
                </div>
                <div class="action-buttons" id="actionButtons">
                    <!-- Action buttons will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="game-hint" id="gameHint">
                <i class="fas fa-question"></i>
            </div>
        </div>
        
        <div class="panel dialog-panel">
            <div class="dialog-title">
                <i class="fas fa-scroll"></i>
                <span>JOURNAL & LOG</span>
            </div>
            <div class="dialog-box" id="dialogBox">
                <div class="dialog-message">
                    <strong>Day 1, 08:00</strong><br>
                    You've washed ashore on a mysterious island. The ship is gone, sunk beneath the waves. You need to find shelter, food, and a way to signal for help.
                </div>
                <!-- Journal entries will be added here -->
            </div>
            <div class="dialog-input" id="dialogInput" style="display: none;">
                <input type="text" id="dialogInputField" placeholder="Type your command...">
                <button id="dialogSubmit">Submit</button>
            </div>
        </div>
    </div>
    
    <!-- Puzzle Modal -->
    <div class="puzzle-modal" id="puzzleModal">
        <div class="puzzle-content">
            <div class="puzzle-title" id="puzzleTitle">Ancient Combination Lock</div>
            <div class="puzzle-instructions" id="puzzleInstructions">You found an ancient lock with three dials. Each dial has numbers 0-9. The combination might be hidden somewhere in the ruins...</div>
            <div class="puzzle-body" id="puzzleBody">
                <!-- Puzzle content will be loaded here -->
            </div>
            <div class="puzzle-actions">
                <button class="puzzle-btn" id="puzzleSubmit">Try Combination</button>
                <button class="puzzle-btn" id="puzzleClose">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Game Over Modal -->
    <div class="game-over-modal" id="gameOverModal">
        <div class="game-over-content">
            <div class="game-over-title" id="gameOverTitle">ESCAPED!</div>
            <div class="game-over-message" id="gameOverMessage">Congratulations! You managed to escape the island after 5 days of survival. You've been rescued by a passing ship!</div>
            <div class="game-over-stats">
                <div class="game-over-stat">
                    <div class="game-over-stat-value" id="finalDays">5</div>
                    <div class="game-over-stat-label">DAYS SURVIVED</div>
                </div>
                <div class="game-over-stat">
                    <div class="game-over-stat-value" id="finalHealth">85</div>
                    <div class="game-over-stat-label">FINAL HEALTH</div>
                </div>
                <div class="game-over-stat">
                    <div class="game-over-stat-value" id="itemsFound">12</div>
                    <div class="game-over-stat-label">ITEMS FOUND</div>
                </div>
            </div>
            <button class="restart-btn" id="restartBtn">PLAY AGAIN</button>
        </div>
    </div>
    
    <!-- Hint Modal -->
    <div class="hint-modal" id="hintModal">
        <div class="hint-content">
            <div class="hint-title">ISLAND SURVIVAL TIPS</div>
            <div class="hint-text" id="hintText">
                • Explore all locations thoroughly<br>
                • Collect and combine items in your inventory<br>
                • Pay attention to clues in your journal<br>
                • Manage your health and energy carefully<br>
                • Some puzzles require items or information from other locations<br>
                • Time passes with each action - plan your days wisely
            </div>
            <button class="hint-close" id="hintClose">Got it!</button>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="game-notification" id="notification">
        <div class="notification-title">
            <i class="fas fa-info-circle"></i>
            <span id="notificationTitle">Item Found!</span>
        </div>
        <div class="notification-message" id="notificationMessage">You found a useful item!</div>
    </div>
    
    <!-- Achievement Badge -->
    <div class="achievement-badge" id="achievementBadge">
        <div class="achievement-title">
            <i class="fas fa-trophy"></i>
            <span id="achievementTitle">Survivor!</span>
        </div>
        <div class="achievement-desc" id="achievementDesc">Survived your first night on the island</div>
    </div>
    
    <!-- Audio elements -->
    <audio id="bgMusic" loop>
        <source src="https://assets.mixkit.co/music/preview/mixkit-mysterious-suspense-579.mp3" type="audio/mpeg">
    </audio>
    <audio id="soundEffect">
        <source src="" type="audio/mpeg">
    </audio>

    <script>
        // Game State
        const gameState = {
            // Player stats
            health: 100,
            energy: 100,
            day: 1,
            time: 8, // 24-hour format
            location: 'beach',
            
            // Inventory
            inventory: [],
            maxInventory: 12,
            selectedItem: null,
            
            // Game progress
            discoveredLocations: ['beach'],
            completedPuzzles: [],
            foundItems: [],
            gameEnding: null,
            actionsTaken: 0,
            
            // Flags for events
            flags: {
                shelterBuilt: false,
                fireStarted: false,
                raftBuilt: false,
                signalFireBuilt: false,
                mapFound: false,
                radioFixed: false
            },
            
            // Game settings
            soundEnabled: true,
            hintsEnabled: true
        };
        
        // Game Data
        const gameData = {
            locations: {
                beach: {
                    name: 'Beach Shoreline',
                    description: 'You wake up on a sandy beach, the sound of waves crashing nearby. The wreckage of a ship is visible further down the coast. The jungle ahead looks dark and foreboding.',
                    background: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80',
                    hotspots: [
                        { x: 30, y: 60, icon: 'fa-ship', label: 'Ship Wreckage', action: 'examineWreckage' },
                        { x: 70, y: 40, icon: 'fa-tree', label: 'Jungle Edge', action: 'enterJungle' },
                        { x: 50, y: 70, icon: 'fa-water', label: 'Ocean', action: 'examineOcean' }
                    ],
                    actions: [
                        { text: 'Search Beach', action: 'searchBeach', energy: 5 },
                        { text: 'Rest', action: 'rest', energy: 0 },
                        { text: 'Build Shelter', action: 'buildShelter', energy: 15, requires: ['wood', 'vine'], hideIf: 'shelterBuilt' }
                    ]
                },
                jungle: {
                    name: 'Dense Jungle',
                    description: 'Thick foliage blocks most sunlight. Strange animal calls echo through the trees. The air is humid and filled with the scent of exotic flowers.',
                    background: 'https://images.unsplash.com/photo-1448375240586-882707db888b?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80',
                    hotspots: [
                        { x: 20, y: 40, icon: 'fa-route', label: 'Beach Path', action: 'enterBeach' },
                        { x: 80, y: 50, icon: 'fa-mountain', label: 'Mountain Path', action: 'enterMountains' },
                        { x: 50, y: 30, icon: 'fa-tree', label: 'Strange Tree', action: 'examineTree' }
                    ],
                    actions: [
                        { text: 'Forage for Food', action: 'forageJungle', energy: 10 },
                        { text: 'Gather Wood', action: 'gatherWood', energy: 8 },
                        { text: 'Search for Fresh Water', action: 'searchWater', energy: 12 }
                    ]
                },
                mountains: {
                    name: 'Rocky Mountains',
                    description: 'Steep cliffs offer a view of the entire island. A cave entrance is visible, and a waterfall cascades down the rocks into a pool below.',
                    background: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80',
                    hotspots: [
                        { x: 25, y: 60, icon: 'fa-door-closed', label: 'Cave Entrance', action: 'enterCave' },
                        { x: 75, y: 40, icon: 'fa-tint', label: 'Waterfall', action: 'examineWaterfall' },
                        { x: 50, y: 20, icon: 'fa-binoculars', label: 'Lookout Point', action: 'useLookout' }
                    ],
                    actions: [
                        { text: 'Climb Higher', action: 'climbMountain', energy: 15 },
                        { text: 'Collect Rocks', action: 'collectRocks', energy: 5 },
                        { text: 'Search for Minerals', action: 'searchMinerals', energy: 10 }
                    ]
                },
                cave: {
                    name: 'Dark Cave',
                    description: 'The air is cool and damp. Strange markings cover the walls, and the sound of dripping water echoes in the darkness.',
                    background: 'https://images.unsplash.com/photo-1532601224476-15c79f2f7a51?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80',
                    hotspots: [
                        { x: 20, y: 50, icon: 'fa-door-open', label: 'Cave Entrance', action: 'enterMountains' },
                        { x: 60, y: 30, icon: 'fa-scroll', label: 'Ancient Drawings', action: 'examineDrawings' },
                        { x: 80, y: 70, icon: 'fa-gem', label: 'Sparkling Object', action: 'examineSparkle' }
                    ],
                    actions: [
                        { text: 'Explore Deeper', action: 'exploreCave', energy: 15 },
                        { text: 'Search for Bats', action: 'searchBats', energy: 10 },
                        { text: 'Examine Markings', action: 'examineMarkings', energy: 5 }
                    ]
                },
                shipwreck: {
                    name: 'Ship Wreckage',
                    description: 'The remains of the ship that brought you here. The hull is torn apart, but some compartments might still contain useful supplies.',
                    background: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80',
                    hotspots: [
                        { x: 30, y: 60, icon: 'fa-arrow-left', label: 'Return to Beach', action: 'enterBeach' },
                        { x: 70, y: 40, icon: 'fa-box-open', label: 'Cargo Hold', action: 'searchCargo' },
                        { x: 50, y: 20, icon: 'fa-tools', label: 'Engine Room', action: 'searchEngine' }
                    ],
                    actions: [
                        { text: 'Search for Supplies', action: 'searchWreckage', energy: 10 },
                        { text: 'Salvage Metal', action: 'salvageMetal', energy: 15 },
                        { text: 'Check Radio', action: 'checkRadio', energy: 5, requires: ['wires', 'battery'] }
                    ]
                }
            },
            
            items: {
                'stick': {
                    name: 'Sturdy Stick',
                    description: 'A solid piece of driftwood. Could be useful for building or defense.',
                    icon: 'fa-tree',
                    type: 'material'
                },
                'vine': {
                    name: 'Strong Vine',
                    description: 'A flexible vine from the jungle. Useful for tying things together.',
                    icon: 'fa-link',
                    type: 'material'
                },
                'coconut': {
                    name: 'Coconut',
                    description: 'A fresh coconut. Contains water and meat for nourishment.',
                    icon: 'fa-seedling',
                    type: 'food',
                    health: 10,
                    energy: 5
                },
                'rock': {
                    name: 'Sharp Rock',
                    description: 'A rock with a sharp edge. Could be used as a tool or weapon.',
                    icon: 'fa-gem',
                    type: 'tool'
                },
                'map': {
                    name: 'Tattered Map',
                    description: 'An old map of the island found in the cave. Shows locations you haven\'t discovered yet.',
                    icon: 'fa-map',
                    type: 'special'
                },
                'battery': {
                    name: 'Marine Battery',
                    description: 'A battery from the ship\'s radio. Might still have some charge.',
                    icon: 'fa-battery-three-quarters',
                    type: 'special'
                },
                'wires': {
                    name: 'Copper Wires',
                    description: 'Electrical wires salvaged from the ship. Could be useful for repairs.',
                    icon: 'fa-bolt',
                    type: 'material'
                },
                'flare': {
                    name: 'Signal Flare',
                    description: 'A flare from the ship\'s emergency kit. Could signal for help.',
                    icon: 'fa-fire',
                    type: 'special'
                },
                'knife': {
                    name: 'Rusty Knife',
                    description: 'A knife found in the wreckage. Useful for cutting and crafting.',
                    icon: 'fa-utensil-knife',
                    type: 'tool'
                },
                'rope': {
                    name: 'Nylon Rope',
                    description: 'Strong rope from the ship. Essential for building structures.',
                    icon: 'fa-rope',
                    type: 'material'
                },
                'berries': {
                    name: 'Wild Berries',
                    description: 'Colorful berries found in the jungle. Some might be edible.',
                    icon: 'fa-apple-alt',
                    type: 'food',
                    health: 5,
                    energy: 3
                },
                'crystal': {
                    name: 'Glowing Crystal',
                    description: 'A strange crystal that glows faintly. Found deep in the cave.',
                    icon: 'fa-gem',
                    type: 'special'
                }
            },
            
            puzzles: {
                caveDrawings: {
                    title: 'Ancient Cave Drawings',
                    instructions: 'The cave walls are covered in mysterious symbols. They seem to tell a story about the island. Some symbols are repeated. Can you decipher the pattern?',
                    type: 'sequence',
                    solution: [3, 1, 4, 2],
                    reward: 'map'
                },
                radioPuzzle: {
                    title: 'Repair the Radio',
                    instructions: 'The ship\'s radio is damaged but might still work. You need to connect the wires correctly to restore power.',
                    type: 'wiring',
                    solution: ['red-blue', 'green-yellow', 'black-white'],
                    reward: 'radioFixed'
                },
                combinationLock: {
                    title: 'Ancient Combination Lock',
                    instructions: 'You found an ancient lock with three dials. The combination might be related to clues found around the island.',
                    type: 'combination',
                    solution: [4, 2, 7],
                    reward: 'crystal'
                }
            },
            
            combinations: {
                'stick+vine': 'spear',
                'stick+rock': 'hammer',
                'vine+rope': 'strongRope',
                'wood+vine': 'raftFrame'
            },
            
            craftedItems: {
                'spear': {
                    name: 'Sharp Spear',
                    description: 'A spear made from a stick and sharp rock. Useful for fishing and defense.',
                    icon: 'fa-fishing-rod',
                    type: 'tool'
                },
                'hammer': {
                    name: 'Stone Hammer',
                    description: 'A primitive hammer. Useful for building and breaking things.',
                    icon: 'fa-hammer',
                    type: 'tool'
                },
                'strongRope': {
                    name: 'Strong Rope',
                    description: 'A reinforced rope made by combining vines and nylon rope.',
                    icon: 'fa-rope',
                    type: 'material'
                },
                'raftFrame': {
                    name: 'Raft Frame',
                    description: 'The basic frame for a raft. Needs more materials to be seaworthy.',
                    icon: 'fa-ship',
                    type: 'special'
                }
            }
        };
        
        // Initialize the game
        function initGame() {
            // Setup audio
            setupAudio();
            
            // Initialize UI
            updateUI();
            renderInventory();
            updateMap();
            
            // Setup event listeners
            setupEventListeners();
            
            // Add starting items
            addToInventory('stick');
            addToInventory('rock');
            
            // Add initial journal entry
            addJournalEntry(`Day ${gameState.day}, ${formatTime(gameState.time)} - Washed ashore on an unknown island. Need to find shelter and supplies.`);
            
            // Show welcome notification
            showNotification('Welcome to Escape Island', 'You\'ve washed ashore. Your goal is to survive and find a way off the island.');
        }
        
        // Setup audio
        function setupAudio() {
            const bgMusic = document.getElementById('bgMusic');
            const soundControl = document.getElementById('soundControl');
            
            // Try to play background music
            bgMusic.volume = 0.3;
            
            soundControl.addEventListener('click', () => {
                gameState.soundEnabled = !gameState.soundEnabled;
                
                if (gameState.soundEnabled) {
                    bgMusic.play().catch(e => console.log('Audio play failed:', e));
                    soundControl.innerHTML = '<i class="fas fa-volume-up"></i>';
                } else {
                    bgMusic.pause();
                    soundControl.innerHTML = '<i class="fas fa-volume-mute"></i>';
                }
            });
            
            // Start with music if enabled
            if (gameState.soundEnabled) {
                bgMusic.play().catch(e => console.log('Audio autoplay failed:', e));
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Action buttons
            document.getElementById('actionButtons').addEventListener('click', handleActionClick);
            
            // Inventory items
            document.getElementById('inventoryGrid').addEventListener('click', handleInventoryClick);
            
            // Puzzle buttons
            document.getElementById('puzzleSubmit').addEventListener('click', handlePuzzleSubmit);
            document.getElementById('puzzleClose').addEventListener('click', closePuzzle);
            
            // Game over buttons
            document.getElementById('restartBtn').addEventListener('click', restartGame);
            
            // Hint system
            document.getElementById('gameHint').addEventListener('click', showHintModal);
            document.getElementById('hintClose').addEventListener('click', closeHintModal);
            
            // Dialog input
            document.getElementById('dialogSubmit').addEventListener('click', handleDialogSubmit);
            document.getElementById('dialogInputField').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleDialogSubmit();
            });
        }
        
        // Update all UI elements
        function updateUI() {
            // Update stats
            document.getElementById('healthValue').textContent = gameState.health;
            document.getElementById('energyValue').textContent = gameState.energy;
            document.getElementById('dayValue').textContent = gameState.day;
            document.getElementById('timeValue').textContent = formatTime(gameState.time);
            
            // Update health and energy bars
            document.getElementById('healthBar').style.width = `${gameState.health}%`;
            document.getElementById('energyBar').style.width = `${gameState.energy}%`;
            
            // Update location
            const location = gameData.locations[gameState.location];
            document.getElementById('locationTitle').textContent = location.name;
            document.getElementById('locationDescription').textContent = location.description;
            
            // Update scene background
            document.getElementById('scene').style.backgroundImage = `url('${location.background}')`;
            
            // Render hotspots
            renderHotspots();
            
            // Update action buttons
            renderActionButtons();
            
            // Update map
            updateMap();
        }
        
        // Format time for display
        function formatTime(hour) {
            const period = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour.toString().padStart(2, '0')}:00 ${period}`;
        }
        
        // Render hotspots for current location
        function renderHotspots() {
            const scene = document.getElementById('scene');
            const location = gameData.locations[gameState.location];
            
            // Clear existing hotspots
            document.querySelectorAll('.hotspot').forEach(el => el.remove());
            
            // Create new hotspots
            location.hotspots.forEach(hotspot => {
                const hotspotEl = document.createElement('div');
                hotspotEl.className = 'hotspot';
                hotspotEl.style.left = `${hotspot.x}%`;
                hotspotEl.style.top = `${hotspot.y}%`;
                hotspotEl.dataset.action = hotspot.action;
                
                hotspotEl.innerHTML = `
                    <i class="fas ${hotspot.icon}"></i>
                    <div class="hotspot-label">${hotspot.label}</div>
                `;
                
                hotspotEl.addEventListener('click', () => handleHotspotClick(hotspot.action));
                
                scene.appendChild(hotspotEl);
            });
        }
        
        // Render action buttons for current location
        function renderActionButtons() {
            const container = document.getElementById('actionButtons');
            const location = gameData.locations[gameState.location];
            
            container.innerHTML = '';
            
            location.actions.forEach(action => {
                // Check if action should be hidden
                if (action.hideIf && gameState.flags[action.hideIf]) {
                    return;
                }
                
                // Check requirements
                let hasRequirements = true;
                if (action.requires) {
                    hasRequirements = action.requires.every(item => 
                        gameState.inventory.some(invItem => invItem.id === item)
                    );
                }
                
                const button = document.createElement('button');
                button.className = 'action-btn';
                button.textContent = action.text;
                button.dataset.action = action.action;
                button.disabled = !hasRequirements || gameState.energy < (action.energy || 0);
                
                if (action.energy > 0) {
                    button.innerHTML = `<i class="fas fa-bolt"></i> ${action.text} (${action.energy} Energy)`;
                }
                
                container.appendChild(button);
            });
        }
        
        // Handle hotspot clicks
        function handleHotspotClick(action) {
            switch(action) {
                case 'enterJungle':
                    changeLocation('jungle');
                    break;
                case 'enterBeach':
                    changeLocation('beach');
                    break;
                case 'enterMountains':
                    changeLocation('mountains');
                    break;
                case 'enterCave':
                    changeLocation('cave');
                    break;
                case 'examineWreckage':
                    changeLocation('shipwreck');
                    break;
                case 'examineTree':
                    examineTree();
                    break;
                case 'examineOcean':
                    examineOcean();
                    break;
                case 'examineWaterfall':
                    examineWaterfall();
                    break;
                case 'examineDrawings':
                    showPuzzle('caveDrawings');
                    break;
                case 'searchCargo':
                    searchCargo();
                    break;
                case 'useLookout':
                    useLookout();
                    break;
            }
        }
        
        // Handle action button clicks
        function handleActionClick(e) {
            if (!e.target.dataset.action) return;
            
            const action = e.target.dataset.action;
            
            switch(action) {
                case 'searchBeach':
                    searchBeach();
                    break;
                case 'rest':
                    rest();
                    break;
                case 'buildShelter':
                    buildShelter();
                    break;
                case 'forageJungle':
                    forageJungle();
                    break;
                case 'gatherWood':
                    gatherWood();
                    break;
                case 'searchWater':
                    searchWater();
                    break;
                case 'climbMountain':
                    climbMountain();
                    break;
                case 'collectRocks':
                    collectRocks();
                    break;
                case 'searchMinerals':
                    searchMinerals();
                    break;
                case 'exploreCave':
                    exploreCave();
                    break;
                case 'searchBats':
                    searchBats();
                    break;
                case 'examineMarkings':
                    examineMarkings();
                    break;
                case 'searchWreckage':
                    searchWreckage();
                    break;
                case 'salvageMetal':
                    salvageMetal();
                    break;
                case 'checkRadio':
                    checkRadio();
                    break;
            }
        }
        
        // Change location
        function changeLocation(newLocation) {
            if (!gameData.locations[newLocation]) return;
            
            // Add to discovered locations if new
            if (!gameState.discoveredLocations.includes(newLocation)) {
                gameState.discoveredLocations.push(newLocation);
                showNotification('New Location Discovered', `You discovered ${gameData.locations[newLocation].name}`);
                
                // Achievement for discovering all locations
                if (gameState.discoveredLocations.length >= 5) {
                    showAchievement('Explorer', 'Discovered all locations on the island!');
                }
            }
            
            gameState.location = newLocation;
            gameState.energy -= 5; // Energy cost for moving
            
            // Add time
            advanceTime(1);
            
            // Update UI
            updateUI();
            
            // Add journal entry
            addJournalEntry(`Moved to ${gameData.locations[newLocation].name}`);
            
            // Check for game over
            checkGameOver();
        }
        
        // Search beach action
        function searchBeach() {
            consumeEnergy(5);
            advanceTime(1);
            
            const foundItems = [];
            
            // Chance to find different items
            if (Math.random() > 0.7) foundItems.push('coconut');
            if (Math.random() > 0.8) foundItems.push('stick');
            if (Math.random() > 0.9) foundItems.push('rope');
            
            if (foundItems.length > 0) {
                foundItems.forEach(item => addToInventory(item));
                showNotification('Items Found', `Found ${foundItems.map(item => gameData.items[item].name).join(', ')}`);
            } else {
                showNotification('Nothing Found', 'You searched the beach but found nothing useful.');
            }
            
            addJournalEntry('Searched the beach for supplies.');
        }
        
        // Rest action
        function rest() {
            const healthGain = 20;
            const energyGain = 30;
            
            gameState.health = Math.min(100, gameState.health + healthGain);
            gameState.energy = Math.min(100, gameState.energy + energyGain);
            
            advanceTime(2);
            
            showNotification('Rested', `Regained ${healthGain} health and ${energyGain} energy.`);
            addJournalEntry('Took a rest to recover strength.');
            
            updateUI();
        }
        
        // Build shelter
        function buildShelter() {
            if (!gameState.flags.shelterBuilt) {
                consumeEnergy(15);
                
                // Remove required items from inventory
                removeFromInventory('wood');
                removeFromInventory('vine');
                
                gameState.flags.shelterBuilt = true;
                
                showNotification('Shelter Built', 'You built a basic shelter. This will protect you from the elements.');
                addJournalEntry('Built a shelter from wood and vines. Feeling safer already.');
                
                // Achievement
                showAchievement('Home Builder', 'Built your first shelter on the island!');
                
                updateUI();
            }
        }
        
        // Forage in jungle
        function forageJungle() {
            consumeEnergy(10);
            advanceTime(1);
            
            const foundItems = [];
            
            if (Math.random() > 0.6) foundItems.push('berries');
            if (Math.random() > 0.7) foundItems.push('vine');
            if (Math.random() > 0.9) foundItems.push('stick');
            
            if (foundItems.length > 0) {
                foundItems.forEach(item => addToInventory(item));
                showNotification('Foraged Items', `Found ${foundItems.map(item => gameData.items[item].name).join(', ')}`);
            } else {
                showNotification('No Food Found', 'You searched but found nothing edible.');
            }
            
            addJournalEntry('Foraged in the jungle for food and materials.');
        }
        
        // Gather wood
        function gatherWood() {
            consumeEnergy(8);
            advanceTime(1);
            
            // Add wood to inventory (simplified - using stick as wood)
            addToInventory('stick');
            addToInventory('stick');
            
            showNotification('Wood Gathered', 'Collected several pieces of wood.');
            addJournalEntry('Gathered wood from the jungle.');
        }
        
        // Search for water
        function searchWater() {
            consumeEnergy(12);
            advanceTime(2);
            
            if (Math.random() > 0.3) {
                gameState.health = Math.min(100, gameState.health + 15);
                gameState.energy = Math.min(100, gameState.energy + 10);
                
                showNotification('Fresh Water Found', 'Found a freshwater stream. Drank and refilled your container.');
                addJournalEntry('Found a freshwater source. Important for survival.');
            } else {
                showNotification('No Water Found', 'Could not find any freshwater sources.');
                addJournalEntry('Searched for water but found none.');
            }
            
            updateUI();
        }
        
        // Climb mountain
        function climbMountain() {
            consumeEnergy(15);
            advanceTime(2);
            
            const foundItems = [];
            
            if (Math.random() > 0.5) foundItems.push('rock');
            if (Math.random() > 0.8) foundItems.push('crystal');
            
            if (foundItems.length > 0) {
                foundItems.forEach(item => addToInventory(item));
                showNotification('Mountain Climb', `Found ${foundItems.map(item => gameData.items[item].name).join(', ')} while climbing.`);
            } else {
                showNotification('Dangerous Climb', 'The climb was treacherous and you found nothing.');
            }
            
            addJournalEntry('Climbed higher up the mountain for a better view.');
        }
        
        // Examine tree in jungle
        function examineTree() {
            advanceTime(0.5);
            
            if (Math.random() > 0.5) {
                addToInventory('vine');
                showNotification('Strange Tree', 'You found strong vines hanging from the tree.');
            } else {
                showNotification('Strange Tree', 'The tree has unusual markings but nothing useful.');
            }
            
            addJournalEntry('Examined a strange-looking tree in the jungle.');
        }
        
        // Examine ocean
        function examineOcean() {
            advanceTime(0.5);
            
            showNotification('The Ocean', 'The ocean stretches to the horizon. Currents seem strong. A raft might be your only hope.');
            addJournalEntry('Studied the ocean currents. Building a raft seems necessary.');
        }
        
        // Examine waterfall
        function examineWaterfall() {
            advanceTime(0.5);
            
            if (!gameState.foundItems.includes('crystal') && Math.random() > 0.7) {
                addToInventory('crystal');
                showNotification('Waterfall Discovery', 'Found a glowing crystal behind the waterfall!');
            } else {
                showNotification('Beautiful Waterfall', 'The waterfall is beautiful but offers no practical help.');
            }
            
            addJournalEntry('Examined the waterfall. The pool below looks clean enough to drink from.');
        }
        
        // Search cargo in shipwreck
        function searchCargo() {
            consumeEnergy(10);
            advanceTime(1);
            
            const foundItems = [];
            
            if (Math.random() > 0.4) foundItems.push('rope');
            if (Math.random() > 0.5) foundItems.push('battery');
            if (Math.random() > 0.7) foundItems.push('flare');
            if (Math.random() > 0.8) foundItems.push('knife');
            
            if (foundItems.length > 0) {
                foundItems.forEach(item => addToInventory(item));
                showNotification('Salvaged Supplies', `Found ${foundItems.map(item => gameData.items[item].name).join(', ')} in the cargo hold.`);
            } else {
                showNotification('Empty Cargo', 'The cargo hold has already been picked clean.');
            }
            
            addJournalEntry('Searched the ship\'s cargo hold for supplies.');
        }
        
        // Use lookout point
        function useLookout() {
            advanceTime(0.5);
            
            if (!gameState.flags.mapFound) {
                gameState.flags.mapFound = true;
                addToInventory('map');
                showNotification('Lookout Point', 'From this high vantage point, you can see the whole island and found a hidden map!');
                addJournalEntry('Used the lookout point. Discovered a hidden map of the island!');
            } else {
                showNotification('Lookout Point', 'You can see the entire island. No ships on the horizon.');
                addJournalEntry('Scanned the horizon from the lookout point. No signs of rescue.');
            }
        }
        
        // Show puzzle
        function showPuzzle(puzzleId) {
            const puzzle = gameData.puzzles[puzzleId];
            if (!puzzle || gameState.completedPuzzles.includes(puzzleId)) return;
            
            document.getElementById('puzzleTitle').textContent = puzzle.title;
            document.getElementById('puzzleInstructions').textContent = puzzle.instructions;
            
            // Clear puzzle body
            const puzzleBody = document.getElementById('puzzleBody');
            puzzleBody.innerHTML = '';
            
            // Create puzzle based on type
            if (puzzle.type === 'combination') {
                createCombinationPuzzle(puzzle);
            } else if (puzzle.type === 'sequence') {
                createSequencePuzzle(puzzle);
            } else if (puzzle.type === 'wiring') {
                createWiringPuzzle(puzzle);
            }
            
            // Store current puzzle ID
            puzzleBody.dataset.puzzleId = puzzleId;
            
            // Show modal
            document.getElementById('puzzleModal').style.display = 'flex';
        }
        
        // Create combination lock puzzle
        function createCombinationPuzzle(puzzle) {
            const puzzleBody = document.getElementById('puzzleBody');
            
            puzzleBody.innerHTML = `
                <div class="combination-lock">
                    <div class="dial-controls">
                        <div class="dial-btn up-btn" data-dial="1">↑</div>
                        <div class="dial" id="dial1">0</div>
                        <div class="dial-btn down-btn" data-dial="1">↓</div>
                    </div>
                    <div class="dial-controls">
                        <div class="dial-btn up-btn" data-dial="2">↑</div>
                        <div class="dial" id="dial2">0</div>
                        <div class="dial-btn down-btn" data-dial="2">↓</div>
                    </div>
                    <div class="dial-controls">
                        <div class="dial-btn up-btn" data-dial="3">↑</div>
                        <div class="dial" id="dial3">0</div>
                        <div class="dial-btn down-btn" data-dial="3">↓</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px; color: #94a3b8;">
                    <em>Clue: The numbers might relate to things you've seen on the island...</em>
                </div>
            `;
            
            // Add event listeners for dial buttons
            puzzleBody.querySelectorAll('.dial-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const dialNum = this.dataset.dial;
                    const dial = document.getElementById(`dial${dialNum}`);
                    const isUp = this.classList.contains('up-btn');
                    let value = parseInt(dial.textContent);
                    
                    if (isUp) {
                        value = (value + 1) % 10;
                    } else {
                        value = (value - 1 + 10) % 10;
                    }
                    
                    dial.textContent = value;
                });
            });
        }
        
        // Create sequence puzzle
        function createSequencePuzzle(puzzle) {
            const puzzleBody = document.getElementById('puzzleBody');
            
            puzzleBody.innerHTML = `
                <div style="text-align: center; margin: 30px 0;">
                    <div style="font-size: 2rem; color: #38bdf8; margin-bottom: 20px;">
                        △ □ ○ ◇
                    </div>
                    <div style="color: #cbd5e1; margin-bottom: 20px;">
                        The symbols appear in a pattern. Select the correct sequence:
                    </div>
                    <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                        ${[1, 2, 3, 4].map(num => `
                            <button class="puzzle-btn sequence-btn" data-value="${num}" style="width: 60px; height: 60px; font-size: 1.5rem;">
                                ${num}
                            </button>
                        `).join('')}
                    </div>
                    <div id="sequenceDisplay" style="margin-top: 20px; font-size: 1.5rem; color: #fbbf24; min-height: 40px;"></div>
                </div>
            `;
            
            // Initialize sequence
            puzzleBody.dataset.sequence = '';
            
            // Add event listeners for sequence buttons
            puzzleBody.querySelectorAll('.sequence-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const value = this.dataset.value;
                    let sequence = puzzleBody.dataset.sequence.split(',').filter(v => v);
                    
                    sequence.push(value);
                    puzzleBody.dataset.sequence = sequence.join(',');
                    
                    document.getElementById('sequenceDisplay').textContent = sequence.join(' - ');
                    
                    // Check if sequence is complete
                    if (sequence.length === puzzle.solution.length) {
                        // Check solution will be handled by puzzle submit
                    }
                });
            });
        }
        
        // Create wiring puzzle
        function createWiringPuzzle(puzzle) {
            const puzzleBody = document.getElementById('puzzleBody');
            
            puzzleBody.innerHTML = `
                <div style="text-align: center; margin: 30px 0;">
                    <div style="color: #cbd5e1; margin-bottom: 20px;">
                        Connect the wires to repair the radio:
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; max-width: 400px; margin: 0 auto 30px;">
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <div class="wire-end" data-color="red" style="color: #ef4444;">Red</div>
                            <div class="wire-end" data-color="blue" style="color: #3b82f6;">Blue</div>
                            <div class="wire-end" data-color="green" style="color: #10b981;">Green</div>
                        </div>
                        <div style="width: 150px; height: 2px; background: #475569; position: relative;">
                            <!-- Wires will be drawn here -->
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <div class="wire-end" data-color="yellow" style="color: #fbbf24;">Yellow</div>
                            <div class="wire-end" data-color="white" style="color: #f8fafc;">White</div>
                            <div class="wire-end" data-color="black" style="color: #1e293b;">Black</div>
                        </div>
                    </div>
                    <div style="color: #94a3b8; font-size: 0.9rem;">
                        Drag from left to right to connect wires
                    </div>
                </div>
            `;
            
            // Simplified wiring puzzle - in a real game, this would have drag and drop
            puzzleBody.dataset.connections = JSON.stringify([]);
        }
        
        // Handle puzzle submission
        function handlePuzzleSubmit() {
            const puzzleBody = document.getElementById('puzzleBody');
            const puzzleId = puzzleBody.dataset.puzzleId;
            const puzzle = gameData.puzzles[puzzleId];
            
            let isCorrect = false;
            
            if (puzzle.type === 'combination') {
                const dial1 = parseInt(document.getElementById('dial1').textContent);
                const dial2 = parseInt(document.getElementById('dial2').textContent);
                const dial3 = parseInt(document.getElementById('dial3').textContent);
                
                isCorrect = (dial1 === puzzle.solution[0] && 
                            dial2 === puzzle.solution[1] && 
                            dial3 === puzzle.solution[2]);
            } else if (puzzle.type === 'sequence') {
                const sequence = puzzleBody.dataset.sequence.split(',').filter(v => v);
                isCorrect = sequence.every((val, idx) => parseInt(val) === puzzle.solution[idx]);
            } else if (puzzle.type === 'wiring') {
                // For demo purposes, accept any submission
                isCorrect = Math.random() > 0.5;
            }
            
            if (isCorrect) {
                // Mark puzzle as completed
                gameState.completedPuzzles.push(puzzleId);
                
                // Give reward
                if (puzzle.reward === 'radioFixed') {
                    gameState.flags.radioFixed = true;
                    showNotification('Radio Repaired!', 'You fixed the radio! Now you can call for help.');
                    addJournalEntry('Successfully repaired the ship\'s radio. Help might be on the way!');
                    
                    // Achievement
                    showAchievement('Radio Technician', 'Repaired the ship\'s radio transmitter!');
                    
                    // This could trigger an ending
                    setTimeout(() => {
                        if (gameState.flags.signalFireBuilt) {
                            showGameOver('rescued', 'You successfully signaled for help using both the radio and signal fire. A rescue ship arrived within hours!');
                        }
                    }, 2000);
                } else {
                    addToInventory(puzzle.reward);
                    showNotification('Puzzle Solved!', `You solved the puzzle and found ${gameData.items[puzzle.reward].name}!`);
                }
                
                closePuzzle();
            } else {
                showNotification('Incorrect', 'That combination doesn\'t seem to work. Try again.');
            }
        }
        
        // Close puzzle modal
        function closePuzzle() {
            document.getElementById('puzzleModal').style.display = 'none';
        }
        
        // Render inventory
        function renderInventory() {
            const container = document.getElementById('inventoryGrid');
            container.innerHTML = '';
            
            // Create inventory slots
            for (let i = 0; i < gameState.maxInventory; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-slot';
                
                if (i < gameState.inventory.length) {
                    const item = gameState.inventory[i];
                    const itemData = gameData.items[item.id] || gameData.craftedItems[item.id];
                    
                    slot.classList.remove('empty');
                    slot.dataset.itemId = item.id;
                    slot.dataset.index = i;
                    
                    slot.innerHTML = `
                        <i class="fas ${itemData.icon} floating-item" style="font-size: 1.8rem; color: #38bdf8;"></i>
                        <div class="item-name">${itemData.name}</div>
                    `;
                } else {
                    slot.classList.add('empty');
                    slot.innerHTML = '<i class="fas fa-plus" style="color: #64748b;"></i>';
                }
                
                container.appendChild(slot);
            }
        }
        
        // Handle inventory clicks
        function handleInventoryClick(e) {
            const slot = e.target.closest('.inventory-slot');
            if (!slot) return;
            
            // Clear previous selection
            document.querySelectorAll('.inventory-slot').forEach(s => {
                s.classList.remove('selected');
            });
            
            // If slot is empty, do nothing
            if (slot.classList.contains('empty')) {
                document.getElementById('itemDetails').classList.remove('active');
                gameState.selectedItem = null;
                return;
            }
            
            // Select this slot
            slot.classList.add('selected');
            
            const itemId = slot.dataset.itemId;
            const itemData = gameData.items[itemId] || gameData.craftedItems[itemId];
            
            // Show item details
            const details = document.getElementById('itemDetails');
            details.classList.add('active');
            document.getElementById('itemDetailsTitle').textContent = itemData.name;
            document.getElementById('itemDetailsDescription').textContent = itemData.description;
            
            // Set selected item
            gameState.selectedItem = itemId;
            
            // Check for combinations
            checkItemCombinations();
        }
        
        // Check for item combinations
        function checkItemCombinations() {
            if (!gameState.selectedItem || gameState.inventory.length < 2) return;
            
            // Find another selected item (for combination)
            // In a full game, you'd have a way to select two items
            const otherItems = gameState.inventory.filter(item => item.id !== gameState.selectedItem);
            
            otherItems.forEach(otherItem => {
                const comboKey1 = `${gameState.selectedItem}+${otherItem.id}`;
                const comboKey2 = `${otherItem.id}+${gameState.selectedItem}`;
                
                if (gameData.combinations[comboKey1]) {
                    const result = gameData.combinations[comboKey1];
                    showNotification('Possible Combination', `Combine ${gameState.selectedItem} with ${otherItem.id} to make ${result}`);
                    
                    // In a full game, you'd have a combine button
                    if (confirm(`Combine ${gameData.items[gameState.selectedItem].name} with ${gameData.items[otherItem.id].name}?`)) {
                        combineItems(gameState.selectedItem, otherItem.id, result);
                    }
                }
            });
        }
        
        // Combine two items
        function combineItems(item1, item2, result) {
            // Remove original items
            removeFromInventory(item1);
            removeFromInventory(item2);
            
            // Add crafted item
            addToInventory(result, true);
            
            showNotification('Items Combined', `Created ${gameData.craftedItems[result].name}!`);
            addJournalEntry(`Combined ${gameData.items[item1].name} with ${gameData.items[item2].name} to make ${gameData.craftedItems[result].name}.`);
            
            // Update UI
            renderInventory();
        }
        
        // Add item to inventory
        function addToInventory(itemId, isCrafted = false) {
            if (gameState.inventory.length >= gameState.maxInventory) {
                showNotification('Inventory Full', 'Your inventory is full. Drop something to make space.');
                return false;
            }
            
            // Check if already found
            if (!gameState.foundItems.includes(itemId)) {
                gameState.foundItems.push(itemId);
            }
            
            // Add to inventory
            gameState.inventory.push({
                id: itemId,
                isCrafted: isCrafted
            });
            
            renderInventory();
            return true;
        }
        
        // Remove item from inventory
        function removeFromInventory(itemId) {
            const index = gameState.inventory.findIndex(item => item.id === itemId);
            if (index !== -1) {
                gameState.inventory.splice(index, 1);
                renderInventory();
                return true;
            }
            return false;
        }
        
        // Consume energy
        function consumeEnergy(amount) {
            gameState.energy = Math.max(0, gameState.energy - amount);
            
            // If energy is 0, lose health
            if (gameState.energy === 0) {
                gameState.health = Math.max(0, gameState.health - 10);
                showNotification('Exhausted', 'You are completely exhausted and losing health!');
            }
            
            updateUI();
        }
        
        // Advance time
        function advanceTime(hours) {
            gameState.time += hours;
            
            // Check for day/night cycle
            if (gameState.time >= 24) {
                gameState.time -= 24;
                gameState.day++;
                
                // Nighttime effects
                if (!gameState.flags.shelterBuilt) {
                    gameState.health = Math.max(0, gameState.health - 20);
                    showNotification('Cold Night', 'Without shelter, you suffered through a cold night.');
                }
                
                // Achievement for surviving first night
                if (gameState.day === 2) {
                    showAchievement('Survivor', 'Survived your first night on the island!');
                }
                
                // Check for game over due to time
                if (gameState.day > 10) {
                    showGameOver('time', 'You survived 10 days on the island but no rescue came. You eventually succumbed to exhaustion.');
                }
            }
            
            // Random events based on time
            if (Math.random() > 0.8) {
                randomEvent();
            }
            
            updateUI();
        }
        
        // Random event
        function randomEvent() {
            const events = [
                {
                    message: 'A sudden rainstorm soaked you through.',
                    effect: () => {
                        gameState.health = Math.max(0, gameState.health - 5);
                        if (!gameState.flags.shelterBuilt) {
                            gameState.health = Math.max(0, gameState.health - 10);
                        }
                    }
                },
                {
                    message: 'You found some wild fruit while walking.',
                    effect: () => {
                        addToInventory('berries');
                    }
                },
                {
                    message: 'A wild animal scared you but ran away.',
                    effect: () => {
                        gameState.energy = Math.max(0, gameState.energy - 5);
                    }
                },
                {
                    message: 'You had a strange dream about the island.',
                    effect: () => {
                        // No effect, just flavor
                    }
                }
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            showNotification('Island Event', event.message);
            event.effect();
            addJournalEntry(`Island event: ${event.message}`);
            
            updateUI();
        }
        
        // Add journal entry
        function addJournalEntry(text) {
            const dialogBox = document.getElementById('dialogBox');
            const entry = document.createElement('div');
            entry.className = 'dialog-message';
            
            const timestamp = `Day ${gameState.day}, ${formatTime(gameState.time)}`;
            entry.innerHTML = `<strong>${timestamp}</strong><br>${text}`;
            
            dialogBox.appendChild(entry);
            dialogBox.scrollTop = dialogBox.scrollHeight;
            
            // Limit journal entries
            if (dialogBox.children.length > 20) {
                dialogBox.removeChild(dialogBox.firstChild);
            }
        }
        
        // Show notification
        function showNotification(title, message) {
            const notification = document.getElementById('notification');
            document.getElementById('notificationTitle').textContent = title;
            document.getElementById('notificationMessage').textContent = message;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Show achievement
        function showAchievement(title, description) {
            const badge = document.getElementById('achievementBadge');
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementDesc').textContent = description;
            
            badge.classList.add('show');
            
            setTimeout(() => {
                badge.classList.remove('show');
            }, 5000);
        }
        
        // Update map display
        function updateMap() {
            const container = document.getElementById('mapLocations');
            container.innerHTML = '';
            
            Object.entries(gameData.locations).forEach(([id, location]) => {
                if (gameState.discoveredLocations.includes(id)) {
                    const locationEl = document.createElement('div');
                    locationEl.className = `map-location ${id === gameState.location ? 'active' : ''}`;
                    locationEl.dataset.locationId = id;
                    
                    locationEl.innerHTML = `
                        <div class="location-indicator"></div>
                        <div class="location-name">${location.name}</div>
                    `;
                    
                    locationEl.addEventListener('click', () => {
                        changeLocation(id);
                    });
                    
                    container.appendChild(locationEl);
                }
            });
        }
        
        // Show hint modal
        function showHintModal() {
            document.getElementById('hintModal').style.display = 'flex';
        }
        
        // Close hint modal
        function closeHintModal() {
            document.getElementById('hintModal').style.display = 'none';
        }
        
        // Handle dialog input
        function handleDialogSubmit() {
            const input = document.getElementById('dialogInputField');
            const text = input.value.trim();
            
            if (text) {
                addJournalEntry(`You: "${text}"`);
                
                // Simple command parser (for demo)
                if (text.toLowerCase().includes('help')) {
                    addJournalEntry('Game: Type commands like "go to jungle", "use stick", or "combine items".');
                } else if (text.toLowerCase().includes('where am i')) {
                    addJournalEntry(`Game: You are at ${gameData.locations[gameState.location].name}`);
                } else {
                    addJournalEntry('Game: (Command not recognized in this demo. Use buttons for actions.)');
                }
                
                input.value = '';
            }
        }
        
        // Check for game over
        function checkGameOver() {
            // Check health
            if (gameState.health <= 0) {
                showGameOver('health', 'Your health reached zero. Without proper care and shelter, you succumbed to the island\'s dangers.');
                return;
            }
            
            // Check for specific endings
            if (gameState.flags.raftBuilt && gameState.flags.mapFound) {
                showGameOver('escape', 'Using the map to navigate and your raft to sail, you escaped the island and were eventually rescued by a passing ship!');
                return;
            }
            
            // Update UI
            updateUI();
        }
        
        // Show game over screen
        function showGameOver(ending, message) {
            gameState.gameEnding = ending;
            
            // Set title based on ending
            let title = 'GAME OVER';
            if (ending === 'rescued' || ending === 'escape') {
                title = 'ESCAPED!';
            } else if (ending === 'time') {
                title = 'TIME RAN OUT';
            }
            
            document.getElementById('gameOverTitle').textContent = title;
            document.getElementById('gameOverMessage').textContent = message;
            
            // Update stats
            document.getElementById('finalDays').textContent = gameState.day;
            document.getElementById('finalHealth').textContent = gameState.health;
            document.getElementById('itemsFound').textContent = gameState.foundItems.length;
            
            // Show modal
            document.getElementById('gameOverModal').style.display = 'flex';
        }
        
        // Restart game
        function restartGame() {
            // Reset game state
            gameState.health = 100;
            gameState.energy = 100;
            gameState.day = 1;
            gameState.time = 8;
            gameState.location = 'beach';
            gameState.inventory = [];
            gameState.discoveredLocations = ['beach'];
            gameState.completedPuzzles = [];
            gameState.foundItems = [];
            gameState.gameEnding = null;
            gameState.actionsTaken = 0;
            gameState.flags = {
                shelterBuilt: false,
                fireStarted: false,
                raftBuilt: false,
                signalFireBuilt: false,
                mapFound: false,
                radioFixed: false
            };
            
            // Clear journal
            document.getElementById('dialogBox').innerHTML = `
                <div class="dialog-message">
                    <strong>Day 1, 08:00</strong><br>
                    You've washed ashore on a mysterious island. The ship is gone, sunk beneath the waves. You need to find shelter, food, and a way to signal for help.
                </div>
            `;
            
            // Add starting items
            addToInventory('stick');
            addToInventory('rock');
            
            // Hide modals
            document.getElementById('gameOverModal').style.display = 'none';
            document.getElementById('puzzleModal').style.display = 'none';
            
            // Update UI
            updateUI();
            renderInventory();
            updateMap();
            
            // Show welcome notification
            showNotification('New Game Started', 'Good luck escaping the island!');
        }
        
        // Initialize the game when page loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>