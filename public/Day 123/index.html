<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ludo Master - Playable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

        :root {
            --red: #e61919;
            --blue: #0070e0;
            --yellow: #ffcc00;
            --green: #00a651;
            --bg: #111827;
        }

        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .board-wrapper {
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .ludo-board {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            grid-template-rows: repeat(15, 1fr);
            width: 90vw;
            height: 90vw;
            max-width: 550px;
            max-height: 550px;
            background: white;
            border: 2px solid #000;
        }

        .cell {
            border: 0.5px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* Base colors */
        .base-red {
            background-color: var(--red);
        }

        .base-green {
            background-color: var(--green);
        }

        .base-yellow {
            background-color: var(--yellow);
        }

        .base-blue {
            background-color: var(--blue);
        }

        .white-area {
            background: white;
            width: 70%;
            height: 70%;
            border-radius: 15%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            padding: 10%;
            gap: 10%;
        }

        .pocket {
            border-radius: 50%;
            border: 1px solid #ccc;
        }

        /* Arrows and Stars */
        .star::after {
            content: '★';
            color: #333;
            font-size: 1.5rem;
        }

        .arrow-red::after {
            content: '▲';
            color: var(--red);
            font-size: 1.2rem;
        }

        .arrow-green::after {
            content: '▶';
            color: var(--green);
            font-size: 1.2rem;
        }

        .arrow-yellow::after {
            content: '▼';
            color: var(--yellow);
            font-size: 1.2rem;
        }

        .arrow-blue::after {
            content: '◀';
            color: var(--blue);
            font-size: 1.2rem;
        }

        /* Path colors */
        .path-red {
            background: var(--red) !important;
        }

        .path-green {
            background: var(--green) !important;
        }

        .path-yellow {
            background: var(--yellow) !important;
        }

        .path-blue {
            background: var(--blue) !important;
        }

        .center-home {
            grid-area: 7/7/10/10;
            position: relative;
            background: white;
            border: 1px solid #000;
        }

        .tri {
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
        }

        .tri-red {
            border-width: 0 40px 48px 40px;
            border-color: transparent transparent var(--red) transparent;
            bottom: 0;
            left: 0;
        }

        .tri-green {
            border-width: 40px 0 40px 48px;
            border-color: transparent transparent transparent var(--green);
            left: 0;
            top: 0;
        }

        .tri-yellow {
            border-width: 48px 40px 0 40px;
            border-color: var(--yellow) transparent transparent transparent;
            top: 0;
            left: 0;
        }

        .tri-blue {
            border-width: 40px 48px 40px 0;
            border-color: transparent var(--blue) transparent transparent;
            right: 0;
            top: 0;
        }

        .piece {
            width: 80%;
            height: 80%;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            z-index: 10;
            transition: transform 0.1s;
        }

        .piece:hover {
            transform: scale(1.1);
        }

        .piece.active {
            animation: pulse 0.6s infinite alternate;
        }

        @keyframes pulse {
            from {
                box-shadow: 0 0 5px white;
            }

            to {
                box-shadow: 0 0 15px white;
                transform: scale(1.1);
            }
        }

        .dice-box {
            background: #1f2937;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            min-width: 150px;
        }

        .die {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 8px;
            margin: 10px auto;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            padding: 5px;
            cursor: pointer;
        }

        .dot {
            background: #000;
            border-radius: 50%;
            width: 8px;
            height: 8px;
            margin: auto;
        }
    </style>
</head>

<body class="p-4 flex flex-col lg:flex-row gap-8">

    <div class="flex flex-col gap-4">
        <h1 class="text-3xl font-black italic tracking-tighter">LUDO MASTER</h1>
        <div id="status-card" class="bg-gray-800 p-4 rounded-lg" role="region" aria-label="Game status">
            <p id="turn-text" class="text-xl font-bold uppercase mb-2" role="status">RED'S TURN</p>
            <div id="player-list" class="space-y-2"></div>
        </div>
        <div class="dice-box">
            <div id="die-ui" class="die" onclick="handleDiceRoll()" role="button" aria-label="Roll the dice"
                tabindex="0">
                <div class="dot" style="grid-area: 2/2"></div>
            </div>
            <p class="text-xs opacity-50 font-bold uppercase mt-2">Tap Dice</p>
        </div>
    </div>

    <div class="board-wrapper">
        <div id="board" class="ludo-board">
            <!-- Center and Bases are hardcoded in CSS/HTML structure -->
            <div class="center-home">
                <div class="tri tri-red"></div>
                <div class="tri tri-green"></div>
                <div class="tri tri-yellow"></div>
                <div class="tri tri-blue"></div>
            </div>
        </div>
    </div>

    <script>
        const PLAYERS = ['red', 'green', 'yellow', 'blue'];
        const COLORS = { red: '#e61919', green: '#00a651', yellow: '#ffcc00', blue: '#0070e0' };

        // Sequence of cells for the shared track
        const TRACK = [
            [13, 6], [12, 6], [11, 6], [10, 6], [9, 6], [8, 5], [8, 4], [8, 3], [8, 2], [8, 1], [8, 0], [7, 0], [6, 0],
            [6, 1], [6, 2], [6, 3], [6, 4], [6, 5], [5, 6], [4, 6], [3, 6], [2, 6], [1, 6], [0, 6], [0, 7], [0, 8],
            [1, 8], [2, 8], [3, 8], [4, 8], [5, 8], [6, 9], [6, 10], [6, 11], [6, 12], [6, 13], [6, 14], [7, 14], [8, 14],
            [8, 13], [8, 12], [8, 11], [8, 10], [8, 9], [9, 8], [10, 8], [11, 8], [12, 8], [13, 8], [14, 8], [14, 7], [14, 6]
        ];

        const HOME_PATHS = {
            red: [[13, 7], [12, 7], [11, 7], [10, 7], [9, 7], [8, 7]],
            green: [[7, 1], [7, 2], [7, 3], [7, 4], [7, 5], [7, 6]],
            yellow: [[1, 7], [2, 7], [3, 7], [4, 7], [5, 7], [6, 7]],
            blue: [[7, 13], [7, 12], [7, 11], [7, 10], [7, 9], [7, 8]]
        };

        const START_IDX = { red: 0, green: 13, yellow: 26, blue: 39 };
        const STAR_POS = [2, 10, 15, 23, 28, 36, 41, 49];

        let state = {
            turn: 0,
            dice: 0,
            hasRolled: false,
            moving: false,
            pieces: {}
        };

        function init() {
            const board = document.getElementById('board');

            // Build Bases
            const basePositions = {
                green: '1/1/7/7', yellow: '1/10/7/16',
                blue: '10/10/16/16', red: '10/1/16/7'
            };

            PLAYERS.forEach(color => {
                const base = document.createElement('div');
                base.className = `cell base-${color}`;
                base.style.gridArea = basePositions[color];
                const whiteArea = document.createElement('div');
                whiteArea.className = 'white-area';
                for (let i = 0; i < 4; i++) {
                    const p = document.createElement('div');
                    p.className = 'pocket';
                    p.id = `pocket-${color}-${i}`;
                    whiteArea.appendChild(p);
                }
                base.appendChild(whiteArea);
                board.appendChild(base);

                state.pieces[color] = Array(4).fill(0).map((_, i) => ({ id: i, pos: -1, status: 'base' }));
            });

            // Build Tracks
            for (let r = 0; r < 15; r++) {
                for (let c = 0; c < 15; c++) {
                    // Only draw if it's a track cell
                    if (isBase(r, c) || isCenter(r, c)) continue;

                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `cell-${r}-${c}`;
                    cell.style.gridArea = `${r + 1}/${c + 1}`;

                    // Add markings
                    const trackIdx = TRACK.findIndex(p => p[0] === r && p[1] === c);
                    if (STAR_POS.includes(trackIdx)) cell.classList.add('star');

                    // Coloring start/entry
                    if (r === 13 && c === 6) cell.classList.add('path-red');
                    if (r === 6 && c === 1) cell.classList.add('path-green');
                    if (r === 1 && c === 8) cell.classList.add('path-yellow');
                    if (r === 8 && c === 13) cell.classList.add('path-blue');

                    // Colored home paths
                    if (c === 7 && r > 8 && r < 14) cell.classList.add('path-red');
                    if (r === 7 && c > 0 && c < 6) cell.classList.add('path-green');
                    if (c === 7 && r > 0 && r < 6) cell.classList.add('path-yellow');
                    if (r === 7 && c > 8 && c < 14) cell.classList.add('path-blue');

                    // Arrows
                    if (r === 14 && c === 7) cell.classList.add('arrow-red');
                    if (r === 7 && c === 0) cell.classList.add('arrow-green');
                    if (r === 0 && c === 7) cell.classList.add('arrow-yellow');
                    if (r === 7 && c === 14) cell.classList.add('arrow-blue');

                    board.appendChild(cell);
                }
            }

            render();
        }

        const isBase = (r, c) => (r < 6 && c < 6) || (r < 6 && c > 8) || (r > 8 && c < 6) || (r > 8 && c > 8);
        const isCenter = (r, c) => (r >= 6 && r <= 8 && c >= 6 && c <= 8);

        function handleDiceRoll() {
            if (state.hasRolled || state.moving) return;
            state.dice = Math.floor(Math.random() * 6) + 1;
            state.hasRolled = true;

            // Update Dice UI
            const dots = { 1: [5], 2: [1, 9], 3: [1, 5, 9], 4: [1, 3, 7, 9], 5: [1, 3, 5, 7, 9], 6: [1, 3, 4, 6, 7, 9] };
            const dieUi = document.getElementById('die-ui');
            dieUi.innerHTML = '';
            for (let i = 1; i <= 9; i++) {
                const d = document.createElement('div');
                if (dots[state.dice].includes(i)) d.className = 'dot';
                dieUi.appendChild(d);
            }

            // Check if any move is possible
            const canMove = state.pieces[PLAYERS[state.turn]].some((_, i) => checkValidMove(PLAYERS[state.turn], i));
            if (!canMove) {
                setTimeout(() => nextTurn(), 1000);
            } else {
                render();
            }
        }

        function checkValidMove(color, idx) {
            const p = state.pieces[color][idx];
            if (p.status === 'finished') return false;
            if (p.status === 'base') return state.dice === 6;
            return p.pos + state.dice <= 56;
        }

        function movePiece(color, idx) {
            if (!state.hasRolled || color !== PLAYERS[state.turn] || !checkValidMove(color, idx)) return;

            const p = state.pieces[color][idx];
            state.moving = true;

            if (p.status === 'base') {
                p.status = 'track';
                p.pos = 0;
            } else {
                p.pos += state.dice;
                if (p.pos === 56) p.status = 'finished';
            }

            // Capture logic
            if (p.status === 'track' && p.pos < 51) {
                const globalIdx = (START_IDX[color] + p.pos) % 52;
                if (!STAR_POS.includes(globalIdx)) {
                    PLAYERS.forEach(other => {
                        if (other === color) return;
                        state.pieces[other].forEach(op => {
                            if (op.status === 'track' && op.pos < 51) {
                                if ((START_IDX[other] + op.pos) % 52 === globalIdx) {
                                    op.status = 'base';
                                    op.pos = -1;
                                }
                            }
                        });
                    });
                }
            }

            if (state.dice === 6) {
                state.hasRolled = false;
            } else {
                nextTurn();
            }

            state.moving = false;
            render();
        }

        function nextTurn() {
            state.hasRolled = false;
            state.turn = (state.turn + 1) % 4;
            render();
        }

        function render() {
            // Update turn text
            const turnTxt = document.getElementById('turn-text');
            const activeColor = PLAYERS[state.turn];
            turnTxt.innerText = `${activeColor}'S TURN`;
            turnTxt.style.color = COLORS[activeColor];

            // Update player list
            const list = document.getElementById('player-list');
            list.innerHTML = PLAYERS.map((c, i) => `
                <div class="flex justify-between items-center p-2 rounded ${i === state.turn ? 'bg-white/10' : 'opacity-40'}">
                    <span class="font-bold text-xs" style="color:${COLORS[c]}">${c.toUpperCase()}</span>
                    <span class="text-xs">${state.pieces[c].filter(x => x.status === 'finished').length}/4</span>
                </div>
            `).join('');

            // Clean old pieces
            document.querySelectorAll('.piece').forEach(p => p.remove());

            // Place pieces
            PLAYERS.forEach(color => {
                state.pieces[color].forEach((p, idx) => {
                    const el = document.createElement('div');
                    el.className = 'piece';
                    el.style.backgroundColor = COLORS[color];
                    if (state.hasRolled && color === PLAYERS[state.turn] && checkValidMove(color, idx)) {
                        el.classList.add('active');
                    }
                    el.onclick = (e) => { e.stopPropagation(); movePiece(color, idx); };

                    if (p.status === 'base') {
                        document.getElementById(`pocket-${color}-${idx}`).appendChild(el);
                    } else if (p.status === 'finished') {
                        document.querySelector('.center-home').appendChild(el);
                        el.style.width = '15px'; el.style.height = '15px';
                    } else {
                        let coords;
                        if (p.pos < 51) {
                            coords = TRACK[(START_IDX[color] + p.pos) % 52];
                        } else {
                            coords = HOME_PATHS[color][p.pos - 51];
                        }
                        const cell = document.getElementById(`cell-${coords[0]}-${coords[1]}`);
                        if (cell) cell.appendChild(el);
                    }
                });
            });
        }

        init();
    </script>
</body>

</html>